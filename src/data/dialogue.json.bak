{

  "beryl_default": {
    "nodes": {
      "0": {
        "npc_text": "Welcome to Beryl's General Goods! What do you need?",
        "player_choices": [
          { "text": "Show me your goods.", "action": "open_shop:beryls_general_goods" },
          { "text": "About that letter...", "next_node": "beryl_confrontation", "condition": "world_flags.beryl_letter_found==true && world_flags.debt_paid_by_beryl==false" },
          { "text": "Finn sent me. Pay 10 silvers.", "next_node": "beryl_refusal", "condition": "world_flags.finn_debt_collection_active==true && world_flags.debt_paid_by_beryl==false && world_flags.beryl_refused_debt==false && world_flags.beryl_letter_found==false" },
          { "text": "Finn sent me. Pay 10 silvers.", "next_node": "beryl_refusal_repeat", "condition": "world_flags.finn_debt_collection_active==true && world_flags.debt_paid_by_beryl==false && world_flags.beryl_refused_debt==true && world_flags.beryl_letter_found==false" },
          { "text": "Goodbye, Beryl.", "closes_dialogue": true }
        ]
      },
      "beryl_refusal": {
        "npc_text": "I... I can't! Business has been slow... please, tell Finn I need more time!",
        "player_choices": [
          { "text": "He wants it now.", "next_node": "beryl_refusal_2" },
          { "text": "Is there any other way?", "next_node": "beryl_help_offer" },
          { "text": "I'll see what I can do.", "closes_dialogue": true, "action": "set_flag:beryl_refused_debt:true" }
        ]
      },
      "beryl_help_offer": {
        "npc_text": "Well... there is one thing. I have a discreet package that needs to go to a client in the Noble Quarter. Deliver it, and I'll consider the debt paid.",
        "player_choices": [
          { "text": "I'll do it.", "action": "add_item:beryl_noble_parcel:1|set_flag:beryl_help_agreed:true", "closes_dialogue": true },
          { "text": "No.", "closes_dialogue": true }
        ]
      },
      "beryl_refusal_2": {
        "npc_text": "I don't have it! Leave me alone!",
        "player_choices": [
          { "text": "Listen, old man... pay up or else.", "next_node": "beryl_pay_intimidate", "req_skill_level": { "skill": "coercion", "level": 10 } },
          { "text": "Fine.", "closes_dialogue": true, "action": "set_flag:beryl_refused_debt:true" }
        ]
      },
      "beryl_refusal_repeat": {
        "npc_text": "I told you, I don't have it! Go away!",
        "player_choices": [
          { "text": "Listen, old man... pay up or else.", "next_node": "beryl_pay_intimidate", "req_skill_level": { "skill": "coercion", "level": 10 } },
          { "text": "Leave.", "closes_dialogue": true }
        ]
      },
      "beryl_pay_intimidate": {
        "npc_text": "A-alright! Don't hurt me! Here's the money! Just go!",
        "player_choices": [
          { "text": "Smart choice.", "closes_dialogue": true, "action": "collect_debt_from:npc_beryl|add_xp:coercion:25|update_relationship:npc_beryl:-30|set_flag:beryl_intimidated:true" }
        ]
      },
      "beryl_pay_intimidate_fail": {
        "npc_text": "You... you don't scare me! Get out before I call the guards!",
        "player_choices": [
          { "text": "Hmph.", "closes_dialogue": true }
        ]
      },
      "beryl_confrontation": {
        "npc_text": "What? That letter... where did you get that?! Give it here!",
        "player_choices": [
          { "text": "Pay the debt (10 Silvers).", "next_node": "beryl_pay_debt" },
          { "text": "Pay the debt + 50 Coppers for my trouble.", "next_node": "beryl_pay_extra" }
        ]
      },
      "beryl_pay_debt": {
        "npc_text": "Fine! Here is the money for Finn. Now give me that letter!",
        "player_choices": [
          { "text": "Pleasure doing business.", "closes_dialogue": true, "action": "collect_debt_from:npc_beryl|remove_item:beryl_noble_letter:1|add_xp:coercion:20|update_relationship:npc_beryl:-10" }
        ]
      },
      "beryl_pay_extra": {
        "npc_text": "You greedy little... Fine! Take it! And never come back!",
        "player_choices": [
          { "text": "Pleasure doing business.", "closes_dialogue": true, "action": "collect_debt_from:npc_beryl|add_money:50|remove_item:beryl_noble_letter:1|add_xp:coercion:40|update_relationship:npc_beryl:-20" }
        ]
      }
    }
  },
  "urchin_default": {
    "nodes": {
      "0": {
        "npc_text": "!!! You saw nothing! I wasn't here!",
        "player_choices": [
          { "text": "Hold it! What are you doing sneaking out of Beryl's?", "next_node": "urchin_caught" }
        ]
      },
      "urchin_caught": {
        "npc_text": "I... I was just... checking the locks! Yeah! Checking the locks for Mr. Beryl!",
        "player_choices": [
          { "text": "At night? With a bag?", "next_node": "urchin_lie" }
        ]
      },
      "urchin_lie": {
        "npc_text": "Okay, okay! I took some food! Don't tell the guards! Please!",
        "player_choices": [
          { "text": "What's that paper in your pocket?", "next_node": "urchin_letter" }
        ]
      },
      "urchin_letter": {
        "npc_text": "This? It's nothing! Just some trash I found!",
        "player_choices": [
          { "text": "Give it to me, or I call the guards.", "next_node": "urchin_intimidate", "req_skill_level": { "skill": "coercion", "level": 5 } },
          { "text": "I'll buy it off you. 5 silvers.", "next_node": "urchin_bribe", "condition": "money>=5" },
          { "text": "Hand it over, kid. Now.", "next_node": "urchin_force" }
        ]
      },
      "urchin_intimidate": {
        "npc_text": "Eep! Okay! Take it! Just don't hurt me!",
        "player_choices": [
          { "text": "Scram.", "action": "add_item:beryl_noble_letter:1|set_flag:beryl_letter_found:true|add_xp:coercion:20", "closes_dialogue": true }
        ]
      },
      "urchin_bribe": {
        "npc_text": "Five silvers? Deal! Here!",
        "player_choices": [
          { "text": "Pleasure doing business.", "action": "add_item:beryl_noble_letter:1|set_flag:beryl_letter_found:true|remove_money:5|add_xp:charisma:20", "closes_dialogue": true }
        ]
      },
      "urchin_force": {
        "npc_text": "Make me! ... Ow! Okay, okay! Take it!",
        "player_choices": [
          { "text": "That's better.", "action": "add_item:beryl_noble_letter:1|set_flag:beryl_letter_found:true", "closes_dialogue": true }
        ]
      }
    }
  },
  "beryl_tavern": {
    "nodes": {
      "0": {
        "npc_text": "Off the clock tonight.",
        "player_choices": [
          { "text": "I delivered the package.", "next_node": "delivery_reward", "condition": "world_flags.beryl_delivery_done==true && world_flags.debt_paid_by_beryl==false" },
          { "text": "Finn sent me. Pay 10 silvers.", "action": "collect_debt_from:npc_beryl", "closes_dialogue": true, "condition": "world_flags.finn_debt_collection_active==true && world_flags.debt_paid_by_beryl==false && world_flags.beryl_help_agreed==false && inventory.beryl_noble_parcel==0" },
          { "text": "Goodbye, Beryl.", "closes_dialogue": true }
        ]
      },
      "delivery_reward": {
        "npc_text": "Excellent work. The client was satisfied? Good. Here is the coin for Finn.",
        "player_choices": [
          { "text": "Take the money.", "action": "collect_debt_from:npc_beryl", "closes_dialogue": true }
        ]
      }
    }
  },
  "kaelen_default": {
    "nodes": {
      "0": {
        "npc_text": "The forge is hot today. What brings you here?",
        "player_choices": [ { "text": "Goodbye, Kaelen.", "closes_dialogue": true } ]
      }
    }
  },
  "cyrus_default": {
    "nodes": {
      "0": {
        "npc_text": "I'm Cyrus, apprentice to Kaelen. Need something forged?",
        "player_choices": [
          { "text": "Old Crank says you know about Finn's crates.", "next_node": "cyrus_scared", "condition": "quest.rebel_path.stage==1" },
          { "text": "Goodbye, Cyrus.", "closes_dialogue": true }
        ]
      },
      "cyrus_scared": {
        "npc_text": "Shh! Not so loud! Kaelen doesn't know... I... I just did what they told me!",
        "player_choices": [
          { "text": "What did you do?", "next_node": "cyrus_confess" }
        ]
      },
      "cyrus_confess": {
        "npc_text": "They made me forge these... odd blades. They call them 'Shadow Blades'. I kept one... a prototype. I was going to show the guards, but I was too scared.",
        "player_choices": [
          { "text": "Give it to me. I'll take it to the guards.", "next_node": "cyrus_give", "action": "add_item:prototype_blade:1|advance_quest_stage:rebel_path" }
        ]
      },
      "cyrus_give": {
        "npc_text": "Here. Please, don't tell Finn I gave it to you.",
        "player_choices": [
          { "text": "You're safe now.", "closes_dialogue": true }
        ]
      }
    }
  },
  "adalia_default": {
    "nodes": {
      "0": {
        "npc_text": "Ah, a visitor to the library.",
        "player_choices": [ { "text": "Goodbye, Adalia.", "closes_dialogue": true } ]
      }
    }
  },
  "matthias_default": {
    "nodes": {
      "0": {
        "npc_text": "Halt! What business do you have at Mosswatch Keep?",
        "player_choices": [
          { "text": "I have something to report.", "next_node": "matthias_report" },
          { "text": "Just passing through.", "closes_dialogue": true }
        ]
      },
      "1": {
        "npc_text": "Try Sergeant Rodrick in the Tidehunter Quarter.",
        "player_choices": [ { "text": "Back", "next_node": "0" } ]
      },
      "matthias_report": {
        "npc_text": "I don't have time for drunk talk. Make it quick.",
        "player_choices": [
          { "text": "[Show Blade] I found this prototype.", "next_node": "matthias_evidence", "condition": "inventory.prototype_blade>=1" },
          { "text": "Never mind.", "closes_dialogue": true }
        ]
      },
      "matthias_evidence": {
        "npc_text": "Let me see that. ... This alloy... this is contraband. Shadow steel. Finn has been smuggling this under our noses?",
        "player_choices": [
          { "text": "There's more where that came from.", "next_node": "matthias_plan" }
        ]
      },
      "matthias_plan": {
        "npc_text": "This is enough for a warrant. Go to Sergeant Rodrick in the Tidehunter Quarter. He will organize the raid.",
        "player_choices": [
          { "text": "I'll go now.", "closes_dialogue": true, "action": "advance_quest_stage:rebel_path|remove_item:prototype_blade:1" }
        ]
      },
      "matthias_raid_ready": {
        "npc_text": "My men are on standby. Go to the Salty Mug. The option to Raid will be available.",
        "player_choices": [
          { "text": "Understood.", "closes_dialogue": true }
        ]
      }
    }
  },
  "rodrick_default": {
    "nodes": {
      "0": {
        "npc_text": "What do you want, kid?",
        "player_choices": [
          { "text": "Matthias sent me. We're ready to raid the Salty Mug.", "action": "trigger_event:raid_salty_mug_intro", "condition": "quest.rebel_path.stage==3" },
          { "text": "Nothing, sir.", "closes_dialogue": true }
        ]
      }
    }
  },
  "boric_intro": {
    "nodes": {
      "0": {
        "npc_text": "Oh, a new face. I haven’t seen you on the docks yet, I know everyone that comes through. Name’s Boric, by the way.",
        "player_choices": [
          { "text": "I’m looking for work.", "next_node": "bi_work", "condition": "relationship.npc_boric>=-50 && job.job_dockhand.active==false && job.job_dockhand.fired==false" },
          { "text": "Can I have my job back?", "next_node": "bi_rehiring", "condition": "job.job_dockhand.fired==true" },
          { "text": "I’m looking for work.", "next_node": "bi_refuse", "condition": "relationship.npc_boric<-50" },
          { "text": "About the job...", "next_node": "bi_work", "condition": "job.job_dockhand.active==true" },
          { "text": "Goodbye, Boric.", "closes_dialogue": true }
        ]
      },
      "bi_work": {
        "npc_text": "Dockhands haul crates, lash lines, and mind the tide. Twenty copper a shift. Hours are eight to four, weekdays. Be here before the horn, and don’t make me regret putting your name in the ledger.",
        "player_choices": [
          { "text": "Hire me.", "action": "hire_job:job_dockhand", "next_node": "0", "condition": "job.job_dockhand.active==false" },
          { "text": "Understood. (Back)", "next_node": "0", "condition": "job.job_dockhand.active==true" },
          { "text": "Not now. (Back)", "next_node": "0", "condition": "job.job_dockhand.active==false" }
        ]
      },
      "bi_refuse": {
        "npc_text": "Get off my pier. I don’t hire dead weight.",
        "player_choices": [ { "text": "I’ll leave you to it.", "closes_dialogue": true } ]
      },
      "bi_rehiring": {
        "npc_text": "We tried you. Missed days or didn’t cut it. You’re off the roster.",
        "player_choices": [
          { "text": "Please, give me another chance.", "action": "try_hire_or_deny:job_dockhand:bi_deny", "next_node": "0" },
          { "text": "I understand. (Back)", "next_node": "0" }
        ]
      },
      "bi_deny": { "npc_text": "No.", "player_choices": [ { "text": "Understood. (Back)", "next_node": "0" } ] }
    }
  },
  "boric_default": {
    "nodes": {
      "0": {
        "npc_text": "Harbor’s loud today. What do you need?",
        "player_choices": [
          { "text": "I’m looking for work.", "next_node": "bd_work", "condition": "relationship.npc_boric>=-50 && job.job_dockhand.active==false && job.job_dockhand.fired==false" },
          { "text": "Can I have my job back?", "next_node": "bd_rehiring", "condition": "job.job_dockhand.fired==true" },
          { "text": "I’m looking for work.", "next_node": "bd_refuse", "condition": "relationship.npc_boric<-50" },
          { "text": "About the job...", "next_node": "bd_work", "condition": "job.job_dockhand.active==true" },
          { "text": "Goodbye, Boric.", "closes_dialogue": true }
        ]
      },
      "bd_work": {
        "npc_text": "Twenty copper a shift, eight to four, weekdays. Show up before the horn.",
        "player_choices": [
          { "text": "Hire me.", "action": "hire_job:job_dockhand", "next_node": "0", "condition": "job.job_dockhand.active==false" },
          { "text": "Understood. (Back)", "next_node": "0", "condition": "job.job_dockhand.active==true" },
          { "text": "Not now. (Back)", "next_node": "0", "condition": "job.job_dockhand.active==false" }
        ]
      },
      "bd_refuse": {
        "npc_text": "Get off my pier. I don’t hire dead weight.",
        "player_choices": [ { "text": "I’ll leave you to it.", "closes_dialogue": true } ]
      },
      "bd_rehiring": {
        "npc_text": "We tried you. Missed days or didn’t cut it. You’re off the roster.",
        "player_choices": [
          { "text": "Please, give me another chance.", "action": "try_hire_or_deny:job_dockhand:bd_deny", "next_node": "0" },
          { "text": "I understand. (Back)", "next_node": "0" }
        ]
      },
      "bd_deny": { "npc_text": "No.", "player_choices": [ { "text": "Understood. (Back)", "next_node": "0" } ] }
    }
  },
  "elias_default": {
    "nodes": {
      "0": {
        "npc_text": "Ahoy! Captain Elias at your service. What tales do you bring?",
        "player_choices": [ { "text": "Goodbye, Captain Elias.", "closes_dialogue": true } ]
      }
    }
  },
  "roberta_default": {
    "nodes": {
      "0": {
        "npc_text": "Tide & Trade, finest goods in Port Kael. What can I get you?",
        "player_choices": [
          { "text": "What's for sale?", "action": "open_shop:tide_and_trade" },
          { "text": "What happened to the wall?", "next_node": "rb_wall", "condition": "quest.roberta_planks_for_the_past.active==false && quest.roberta_planks_for_the_past.completed==false" },
          { "text": "How is the wall repair going?", "next_node": "rb_help_gate", "condition": "quest.roberta_planks_for_the_past.active==true" },
          { "text": "I have the planks you needed.", "action": "complete_quest:roberta_planks_for_the_past", "next_node": "0", "condition": "quest.roberta_planks_for_the_past.active==true && inventory.wood_plank>=5" },
          { "text": "Tell me about Tide & Trade.", "next_node": "rb_lore_tide_trade1", "condition": "world_flags.roberta_lore_seen==false" },
          { "text": "Goodbye, Roberta.", "closes_dialogue": true }
        ]
      },
      "rb_wall": {
        "npc_text": "The storm took a chunk out of the east storehouse. I need planks to patch it before the next high tide.",
        "player_choices": [
          { "text": "I can help with that.", "next_node": "rb_help_gate", "condition": "relationship.npc_roberta>=20" },
          { "text": "I can help with that.", "next_node": "rb_trust_refusal", "condition": "relationship.npc_roberta<20" },
          { "text": "Sorry to hear that. (Back)", "next_node": "0" }
        ]
      },
      "rb_trust_refusal": {
        "npc_text": "I appreciate the offer, but I don't know you well enough to trust you with my shop's repairs yet. Maybe stick around, trade a bit, and we'll see.",
        "player_choices": [
          { "text": "Understood. (Back)", "next_node": "0" }
        ]
      },
      "rb_help_gate": {
        "npc_text": "I'll pay you for the trouble. I need 5 Wood Planks. You can find them at the lumberyard or scavenging the shore.",
        "player_choices": [
          { "text": "I'll find them.", "action": "start_quest:roberta_planks_for_the_past", "next_node": "0", "condition": "quest.roberta_planks_for_the_past.active==false" },
          { "text": "I'm still looking.", "next_node": "0", "condition": "quest.roberta_planks_for_the_past.active==true" }
        ]
      },
      "rb_lore_tide_trade1": {
        "npc_text": "Tide & Trade is one of Driftwatch’s oldest shops. It’s stood through lean years and storms.",
        "player_choices": [ { "text": "And your family?", "next_node": "rb_lore_tide_trade2" } ]
      },
      "rb_lore_tide_trade2": {
        "npc_text": "My father ran it for decades. He passed recently… I'm still learning to handle everything.",
        "player_choices": [ { "text": "Back to counter", "next_node": "0", "action": "set_flag:roberta_lore_seen:true" } ]
      },
      "rb_lore_family": {
        "npc_text": "It's just me now. The shop is all I have left of them.",
        "player_choices": [ { "text": "Back to counter", "next_node": "0" } ]
      }
    }
  },
  "roberta_planks_active": {
    "nodes": {
      "0": {
        "npc_text": "Any progress on the planks?",
        "player_choices": [
          { "text": "How do I get planks again?", "next_node": "1" },
          { "text": "I brought the planks.", "next_node": "reward", "action": "advance_quest_stage:roberta_planks_for_the_past", "condition": "quest.roberta_planks_for_the_past.stage==3" },
          { "text": "What's for sale?", "action": "open_shop:tide_and_trade" },
          { "text": "I'll come back later.", "closes_dialogue": true }
        ]
      },
      "1": {
        "npc_text": "Cut logs in the woods, then use the sawmill to make planks. I'll brace the wall once you have them.",
        "player_choices": [ { "text": "Back to counter", "next_node": "0" } ]
      },
      "reward": {
        "npc_text": "Thank you. This will hold. Here's your payment.",
        "player_choices": [ { "text": "Back to counter", "next_node": "0", "action": "complete_quest:roberta_planks_for_the_past" } ]
      }
    }
  },
  "roberta_planks_completed": {
    "nodes": {
      "0": {
        "npc_text": "The patch held through the last squall. I couldn’t have done it without you.",
        "player_choices": [
          { "text": "What's for sale?", "action": "open_shop:tide_and_trade" },
          { "text": "Tell me about Tide & Trade.", "next_node": "tide_trade_lore", "condition": "world_flags.roberta_lore_seen==false" },
          { "text": "I'll come back later.", "closes_dialogue": true }
        ]
      },
      "tide_trade_lore": {
        "npc_text": "Tide & Trade is one of Driftwatch’s oldest shops. It’s stood through lean years and storms.",
        "player_choices": [ { "text": "And your family?", "next_node": "tide_trade_lore2" } ]
      },
      "tide_trade_lore2": {
        "npc_text": "My father ran it for decades. He passed recently… I'm still learning to handle everything.",
        "player_choices": [ { "text": "Back to counter", "next_node": "0", "action": "set_flag:roberta_lore_seen:true" } ]
      }
    }
  },
  "finn_default": {
    "nodes": {
      "0": {
        "npc_text": "Welcome to the Salty Mug.",
        "player_choices": [
          { "text": "Let me see your stock.", "action": "open_shop:salty_mug" },
          { "text": "About the collection job.", "next_node": "job_progress", "condition": "world_flags.finn_debt_collection_active==true" },
          { "text": "Leave.", "closes_dialogue": true }
        ]
      },
      "job_progress": {
        "npc_text": "Three names. Ten silvers each. Bring me thirty when you're done.",
        "player_choices": [
          { "text": "Here is the 30 silvers.", "next_node": "job_complete_loyalist", "action": "remove_money:30|complete_quest:finn_debt_collection|add_xp:charisma:100", "condition": "money>=30 && world_flags.debt_paid_by_ben==true && world_flags.debt_paid_by_elara==true && world_flags.debt_paid_by_beryl==true && world_flags.ben_cheat_done==false && world_flags.elara_helped_drug==false && world_flags.beryl_helped_pimp==false" },
          { "text": "Here is the 30 silvers.", "next_node": "finn_weakness_reveal", "action": "remove_money:30|complete_quest:finn_debt_collection", "condition": "money>=30 && world_flags.debt_paid_by_ben==true && world_flags.debt_paid_by_elara==true && world_flags.debt_paid_by_beryl==true && (world_flags.ben_cheat_done==true || world_flags.elara_helped_drug==true || world_flags.beryl_helped_pimp==true)" },
          { "text": "I collected most of it... but I forgave Beryl.", "next_node": "finn_fail_beryl", "condition": "world_flags.beryl_debt_forgiven==true" },
          { "text": "I'll get back to it.", "closes_dialogue": true }
        ]
      },
      "finn_weakness_reveal": {
        "npc_text": "Thirty silvers. You got it. But I hear things, kid. I hear how you got it.",
        "player_choices": [
          { "text": "What do you mean?", "next_node": "finn_mockery_ben", "condition": "world_flags.ben_cheat_done==true" },
          { "text": "What do you mean?", "next_node": "finn_mockery_elara", "condition": "world_flags.ben_cheat_done==false && world_flags.elara_helped_drug==true" },
          { "text": "What do you mean?", "next_node": "finn_mockery_beryl", "condition": "world_flags.ben_cheat_done==false && world_flags.elara_helped_drug==false && world_flags.beryl_helped_pimp==true" }
        ]
      },
      "finn_mockery_ben": {
        "npc_text": "Oh, you helped Ben stealing.",
        "player_choices": [
          { "text": "...", "next_node": "finn_mockery_elara", "condition": "world_flags.elara_helped_drug==true" },
          { "text": "...", "next_node": "finn_mockery_beryl", "condition": "world_flags.elara_helped_drug==false && world_flags.beryl_helped_pimp==true" },
          { "text": "...", "next_node": "finn_attack", "condition": "world_flags.elara_helped_drug==false && world_flags.beryl_helped_pimp==false" }
        ]
      },
      "finn_mockery_elara": {
        "npc_text": "Oh, you was a drug mule for the woman.",
        "player_choices": [
          { "text": "...", "next_node": "finn_mockery_beryl", "condition": "world_flags.beryl_helped_pimp==true" },
          { "text": "...", "next_node": "finn_attack", "condition": "world_flags.beryl_helped_pimp==false" }
        ]
      },
      "finn_mockery_beryl": {
        "npc_text": "You were a pimp for Beryl.",
        "player_choices": [
          { "text": "...", "next_node": "finn_attack" }
        ]
      },
      "finn_attack": {
        "npc_text": "That is weakness. And the Guild has no room for weakness.",
        "player_choices": [
          { "text": "Wait!", "action": "trigger_game_over", "closes_dialogue": true }
        ]
      },
      "job_complete_loyalist": {
        "npc_text": "Heh. You actually did it. You have potential, kid. Ruthless. Efficient. Just like... well, nevermind. Here. Take this. It's a key... of sorts. Show it to the wall in the cellar. You might find new friends.",
        "player_choices": [
          { "text": "What is this?", "closes_dialogue": true, "action": "add_item:vanessas_charm:1|trigger_event:evil_path_end" }
        ]
      },
      "finn_fail_beryl": {
        "npc_text": "You what? You let a mark cry you into submission? Pathetic. You're paying his share out of your own pocket then. Do you have the 30 silvers?",
        "player_choices": [
          { "text": "Yes. Here.", "next_node": "finn_fail_beryl_pay", "condition": "money>=30" },
          { "text": "Not yet.", "closes_dialogue": true }
        ]
      },
      "finn_fail_beryl_pay": {
        "npc_text": "Good. Next time, don't be so soft. Now get out of my sight.",
        "player_choices": [
          { "text": "...", "closes_dialogue": true, "action": "remove_money:30|complete_quest:finn_debt_collection" }
        ]
      },
      "jd_rebuke": {
        "npc_text": "Come back when you have the silver, kid.",
        "player_choices": [ { "text": "Leave.", "closes_dialogue": true } ]
      }
    }
  },
  "finn_debt_intro": {
    "nodes": {
      "0": {
        "npc_text": "Pay up.",
        "player_choices": [
          { "text": "I'll pay up.", "next_node": "math", "action": "set_flag:finn_debt_intro_pending:false" },
          { "text": "I don't have the money.", "next_node": "math", "action": "set_flag:finn_debt_intro_pending:false" },
          { "text": "Please, give me a chance.", "next_node": "math", "action": "set_flag:finn_debt_intro_pending:false" }
        ]
      },
      "math": {
        "npc_text": "Three months at twenty copper a day. Eighteen silvers you owe, and you don't have it. Here's the job, make three pay for you: Ben at the farm, Beryl at General Goods, and Elara in her hovel. Ten silvers from each. Thirty days. Bring me thirty silvers. And listen close: no violence. We're professionals, not thugs.",
        "player_choices": [
          { "text": "I accept.", "action": "start_quest:finn_debt_collection|start_debt_collection", "closes_dialogue": true },
          { "text": "No choice. I'll do it.", "action": "start_quest:finn_debt_collection|start_debt_collection", "closes_dialogue": true }
        ]
      }
    }
  },
  "old_crank_default": {
    "nodes": {
      "0": {
        "npc_text": "Bah! Another whelp in the tavern. (He eyes your drink).",
        "player_choices": [
          { "text": "Give Beer (Gossip)", "next_node": "crank_gossip_1", "action": "remove_item:beer:1|set_flag:crank_beer_1:true", "condition": "inventory.beer>=1 && world_flags.crank_beer_1==false" },
          { "text": "Give Beer (Gossip)", "next_node": "crank_gossip_2", "action": "remove_item:beer:1|set_flag:crank_beer_2:true", "condition": "inventory.beer>=1 && world_flags.crank_beer_1==true && world_flags.crank_beer_2==false" },
          { "text": "Give Beer (Gossip)", "next_node": "crank_gossip_3", "action": "remove_item:beer:1|set_flag:crank_beer_3:true|start_quest:rebel_path|advance_quest_stage:rebel_path", "condition": "inventory.beer>=1 && world_flags.crank_beer_2==true && world_flags.crank_beer_3==false" },
          { "text": "Leave.", "closes_dialogue": true }
        ]
      },
      "crank_gossip_1": {
        "npc_text": "Ah... that hits the spot. Did you know Roberta at Tide & Trade has been skimming off the top? Her 'fresh' fish ain't always fresh.",
        "player_choices": [ { "text": "Interesting.", "next_node": "0" } ]
      },
      "crank_gossip_2": {
        "npc_text": "More? You're alright, kid. Captain Elias... he keeps a bottle of rum in his desk. Drinks on the job, he does.",
        "player_choices": [ { "text": "Is that so?", "next_node": "0" } ]
      },
      "crank_gossip_3": {
        "npc_text": "Listen close. Finn... he's dealing in illegal weapons. I saw his boys moving crates to the Forge. Talk to Cyrus, the apprentice. He knows.",
        "player_choices": [ { "text": "I'll investigate.", "closes_dialogue": true } ]
      }
    }
  },

  "finn_timeout_event": {
    "nodes": {
      "0": {
        "npc_text": "Time's up, kid. I gave you seven days.",
        "player_choices": [
          { "text": "Wait, I can explain!", "next_node": "1" }
        ]
      },
      "1": {
        "npc_text": "Save it. Boys, teach him a lesson about deadlines.",
        "player_choices": [
          { "text": "[Fight] You can't take me!", "next_node": "game_over" },
          { "text": "[Submit] No, please!", "next_node": "game_over" }
        ]
      },
      "game_over": {
        "npc_text": "[GAME OVER] The beating is severe. You fade into darkness... (Refresh to restart)",
        "player_choices": [
          { "text": "...", "closes_dialogue": true, "action": "trigger_game_over" }
        ]
      }
    }
  },
  "crawler_default": {
    "nodes": {
      "0": {
        "npc_text": "Logs to planks? 2 copper per plank.",
        "player_choices": [
          {
            "text": "Can I use your sawmill?",
            "next_node": "unlock",
            "condition": "world_flags.sawmill_unlocked==false"
          },
          { "text": "Leave.", "closes_dialogue": true }
        ]
      },
      "unlock": {
        "npc_text": "You can. Two copper per plank. Use the sawmill outside.",
        "player_choices": [
          { "text": "Thanks.", "closes_dialogue": true, "action": "set_flag:sawmill_unlocked:true" }
        ]
      },
      "thanks": { "npc_text": "Right.", "player_choices": [ { "text": "Leave.", "closes_dialogue": true } ] }
    }
  },
  "ronald_default": {
    "nodes": {
      "0": {
        "npc_text": "The woods are dangerous. What brings you?",
        "player_choices": [
          {
            "text": "I noticed your workbench. Mind if I use it?",
            "next_node": "crafting_unlock",
            "condition": "world_flags.hunter_crafting_unlocked==false"
          },
          {
            "text": "Goodbye, Ronald.",
            "closes_dialogue": true
          }
        ]
      },
      "crafting_unlock": {
        "npc_text": "You know your way around tools? Fine. Just don't dull my blades.",
        "player_choices": [
          {
            "text": "Thanks.",
            "action": "set_flag:hunter_crafting_unlocked:true",
            "closes_dialogue": true
          }
        ]
      }
    }
  },
  "ben_default": {
    "nodes": {
      "0": {
        "npc_text": "Hard work on the farm. What can I do for you?",
        "player_choices": [
          { "text": "[Collect Share] We won! Pay up.", "next_node": "ben_pay_cheat", "condition": "world_flags.ben_cheat_done==true && world_flags.debt_paid_by_ben==false" },
          { "text": "Finn sent me. Pay 10 silvers.", "next_node": "debt_collection", "condition": "world_flags.finn_debt_collection_active==true && world_flags.debt_paid_by_ben==false && world_flags.ben_cheat_agreed==false" },
          { "text": "Goodbye, Ben.", "closes_dialogue": true }
        ]
      },
      "debt_collection": {
        "npc_text": "Finn? Look, I barely have copper for seeds, let alone silver for rent. I can't pay... wait. I have a plan. The tables at the Salty Mug are busy tonight. I know a way to win, but I need a partner. Help me cheat, and I'll have the silver.",
        "player_choices": [
          { "text": "Fine. I'll help you cheat.", "next_node": "ben_cheat_agree", "condition": "world_flags.ben_cheat_agreed==false" },
          { "text": "No. Pay now.", "closes_dialogue": true }
        ]
      },
      "ben_cheat_agree": {
        "npc_text": "Good. Meet me at the Salty Mug tonight. Just follow my lead, and don't get caught.",
        "player_choices": [
          { "text": "See you tonight.", "closes_dialogue": true, "action": "set_flag:ben_cheat_agreed:true" }
        ]
      },
      "ben_pay_cheat": {
        "npc_text": "Whoa, that was close... *hic* Thanks for the help, partner! Here's your 10 silver... don't tell Elisa I'm sloshed.",
        "player_choices": [
          { "text": "Pleasure doing business.", "action": "collect_debt_from:npc_ben", "closes_dialogue": true }
        ]
      }
    }
  },
  "elisa_default": {
    "nodes": {
      "0": {
        "npc_text": "Welcome to the farm.",
        "player_choices": [
          { "text": "Goodbye, Elisa.", "closes_dialogue": true },
          { "text": "I need to talk to you.", "next_node": "elisa_night_raid", "condition": "time.is_night==true" }
        ]
      },
      "elisa_night_raid": {
        "npc_text": "He's... out. Drinking away our savings again. What do you want at this hour?",
        "player_choices": [
          { "text": "Ben refuses to pay. You're going to cover his debt. Open your pockets.", "next_node": "elisa_scared" },
          { "text": "Nothing.", "closes_dialogue": true }
        ]
      },
      "elisa_scared": {
        "npc_text": "I... I don't have any money! Please!",
        "player_choices": [
          { "text": "That locket looks valuable. Hand it over.", "next_node": "elisa_give_locket" }
        ]
      },
      "elisa_locket_confrontation": {
        "npc_text": "The... the locket? That was my grandmother's! You can't have it!",
        "player_choices": [
          { "text": "Give it to me, or I'll tell Finn you're holding out.", "next_node": "elisa_give_locket", "req_skill_level": { "skill": "coercion", "level": 10 } },
          { "text": "It's for the debt. Hand it over.", "next_node": "elisa_give_locket_force" }
        ]
      },
      "elisa_give_locket": {
        "npc_text": "No! It's my grandmother's! ... Okay! Take it! Just don't hurt me!",
        "player_choices": [
          { "text": "Pleasure doing business.", "closes_dialogue": true, "action": "add_item:antique_locket:1|update_relationship:npc_elisa:-50" }
        ]
      },
      "elisa_give_locket_force": {
        "npc_text": "No! Get out! (She grabs a pitchfork)",
        "player_choices": [
          { "text": "Bad move. (Attack)", "action": "start_combat:elisa_combat", "closes_dialogue": true },
          { "text": "Relax, I'm going.", "closes_dialogue": true }
        ]
      }
    }
  },
  "rowan_default": {
    "nodes": {
      "0": {
        "npc_text": "I'm Rowan. What?",
        "player_choices": [ { "text": "Goodbye, Rowan.", "closes_dialogue": true } ]
      }
    }
  },
  "old_leo_default": {
    "nodes": {
      "0": {
        "npc_text": "Welcome home, child.",
        "player_choices": [
          { "text": "Hey Leo, can you remind me of the story of the lighthouse?", "next_node": "lighthouse_lore", "condition": "world_flags.leo_lighthouse_history_seen==false" },
          { "text": "Goodbye, Leo.", "closes_dialogue": true }
        ]
      },
      "1": {
        "npc_text": "Stay safe.",
        "player_choices": [ { "text": "Back", "next_node": "0" } ]
      },
      "lighthouse_lore": {
        "npc_text": "Years ago, a great fire swept Driftwatch, burning nearly forty percent of the town. The orphanage, our lighthouse, was among the places caught in the blaze. A man named Leo carried sixteen children to safety, giving his own life to save them. That is why he is remembered as a Son of the Moon.",
        "player_choices": [
          { "text": "Who are the Sons of the Moon?", "next_node": "sons_moon" },
          { "text": "Thank you, Leo.", "closes_dialogue": true, "action": "set_flag:leo_lighthouse_history_seen:true" }
        ]
      },
      "sons_moon": {
        "npc_text": "They are heroes the Moon speaks to called in hard times to guide and protect, so people can endure and pass through their trials.",
        "player_choices": [
          { "text": "Thank you.", "closes_dialogue": true, "action": "set_flag:leo_sons_of_the_moon_seen:true" }
        ]
      }
    }
  },
  "sarah_default": {
    "nodes": {
      "0": {
        "npc_text": "Hi Luke!",
        "player_choices": [ { "text": "See you soon, Sarah.", "closes_dialogue": true } ]
      }
      
    }
  },
  "robert_default": {
    "nodes": {
      "0": {
        "npc_text": "Hey Luke.",
        "player_choices": [ { "text": "See you soon, Robert.", "closes_dialogue": true } ]
      }
      
    }
  },
  "kyle_default": {
    "nodes": {
      "0": {
        "npc_text": "Luke!",
        "player_choices": [ { "text": "See you soon, Kyle.", "closes_dialogue": true } ]
      }
      
    }
  }
  ,
  "kyle_smuggler_alert": {
    "nodes": {
      "0": {
        "npc_text": "Luke—wake up. Robert slipped out before dawn. I saw him heading toward the docks with some rough-looking men.",
        "player_choices": [
          { "text": "We go now.", "closes_dialogue": true }
        ]
      }
    }
  },
  "old_leo_intro": {
    "nodes": {
      "0": {
        "npc_text": "Good morning, Luke. I waited at the door last night and you did not come until the lamps burned low. Tell me, what kept you so long?",
        "player_choices": [
          { "text": "I lingered at the canals, practicing with the nets.", "next_node": "fish", "action": "grant_skill_level:fishing:3|add_item:fishing_rod:1" },
          { "text": "I stayed on the street speaking with Roberta.", "next_node": "roberta", "action": "grant_skill_level:persuasion:3|set_relationship:npc_roberta:20|set_flag:intro_spoke_roberta:true|add_known_npc:npc_roberta" },
          { "text": "I was drawn into a fight with a noble boy.", "next_node": "fight", "action": "grant_skill_level:attack:3|add_item:crude_knife:1" }
        ]
      },
      "fish": {
        "npc_text": "Diligence at the water is an honest answer. The canals can teach a careful hand. Still, do not keep the orphanage waiting again. Go and take your breakfast, and return with a steadier habit.",
        "player_choices": [
          { "text": "Yes, Leo.", "closes_dialogue": true }
        ]
      },
      "roberta": {
        "npc_text": "Words well placed can mend more than boards. Roberta is a good sort; keep good company, and mind your hours. Go now and eat before the day runs ahead of you.",
        "player_choices": [
          { "text": "Yes, Leo.", "closes_dialogue": true }
        ]
      },
      "fight": {
        "npc_text": "No more brawling, Luke. Pride is a poor meal and trouble is quick to follow it. If you wish to stand tall, do so in your work. Go and take your breakfast, and do not be late again.",
        "player_choices": [
          { "text": "Yes, Leo.", "closes_dialogue": true }
        ]
      }
    }
  },
  "sarah_intro": {
    "nodes": {
      "0": {
        "npc_text": "Hi Luke! Want to help me later?",
        "player_choices": [
          { "text": "Let's play.", "closes_dialogue": true, "action": "set_flag:played_midday:true|update_relationship:npc_sarah:10" },
          { "text": "Talk to you later.", "closes_dialogue": true }
        ]
      }
    }
  },
  "robert_intro": {
    "nodes": {
      "0": {
        "npc_text": "Luke, think we can team up sometime?",
        "player_choices": [
          { "text": "Let's play.", "closes_dialogue": true, "action": "set_flag:played_midday:true|update_relationship:npc_robert:10" },
          { "text": "Talk to you later.", "closes_dialogue": true }
        ]
      }
    }
  },
  "kyle_intro": {
    "nodes": {
      "0": {
        "npc_text": "Luke! Want to run around a bit?",
        "player_choices": [
          { "text": "Let's play.", "closes_dialogue": true, "action": "set_flag:played_midday:true|update_relationship:npc_kyle:10" },
          { "text": "Talk to you later.", "closes_dialogue": true }
        ]
      }
    }
  },
  "beryl_debt_approach": {
    "nodes": {
      "0": {
        "npc_text": "Welcome to Beryl's General Goods!",
        "player_choices": [
          { "text": "Show me your goods.", "closes_dialogue": true, "action": "open_shop:beryls_general_goods" },
          { "text": "I delivered the package.", "next_node": "delivery_reward", "condition": "world_flags.beryl_delivery_done==true && world_flags.debt_paid_by_beryl==false" },
          { "text": "Finn sent me. Pay 10 silvers.", "next_node": "debt_confrontation", "condition": "world_flags.finn_debt_collection_active==true && world_flags.debt_paid_by_beryl==false && world_flags.beryl_help_agreed==false && inventory.beryl_noble_parcel==0" },
          { "text": "Goodbye, Beryl.", "closes_dialogue": true }
        ]
      },
      "debt_confrontation": {
        "npc_text": "Ten silvers? That's a lot of money. What are my options?",
        "player_choices": [
          { "text": "You could help me with some chores.", "next_node": "soft_approach", "condition": "world_flags.beryl_soft_approach_started==false" },
          { "text": "I found this interesting letter...", "next_node": "hard_approach", "condition": "inventory.beryl_noble_letter>0 && world_flags.beryl_hard_approach_started==false" },
          { "text": "Just pay up or else.", "action": "collect_debt_from:npc_beryl", "closes_dialogue": true },
          { "text": "I'll come back later.", "closes_dialogue": true }
        ]
      },
      "soft_approach": {
        "npc_text": "Chores? No... but I do have a delicate matter. I need a package delivered to a customer in the Noble Quarter. A... discreet package.",
        "player_choices": [
          { "text": "I'll deliver it.", "action": "add_item:beryl_noble_parcel:1|set_flag:beryl_help_agreed:true", "closes_dialogue": true, "condition": "inventory.beryl_noble_parcel==0" },
          { "text": "Actually, let me think about it.", "closes_dialogue": true }
        ]
      },
      "hard_approach": {
        "npc_text": "A letter? What kind of letter?",
        "player_choices": [
          { "text": "A letter about you and a certain noble woman...", "action": "set_flag:beryl_hard_approach_started:true|remove_item:beryl_noble_letter:1|update_relationship:npc_beryl:-20", "next_node": "blackmail_result" },
          { "text": "Never mind.", "closes_dialogue": true }
        ]
      },
      "blackmail_result": {
        "npc_text": "You... you found that? Fine! Take your ten silvers and leave me be!",
        "player_choices": [
          { "text": "Pleasure doing business.", "action": "collect_debt_from:npc_beryl", "closes_dialogue": true }
        ]
      },
      "delivery_reward": {
        "npc_text": "Excellent work. The client was satisfied? Good. Here is the coin for Finn.",
        "player_choices": [
          { "text": "Take the money.", "action": "collect_debt_from:npc_beryl", "closes_dialogue": true }
        ]
      }
    }
  },
  "elara_default": {
    "nodes": {
      "0": {
        "npc_text": "Herbs, potions, salves... I have everything a healer needs.",
        "player_choices": [
          { "text": "Show me your wares.", "action": "open_shop:herbalists_hovel" },
          { "text": "Finn sent me. Pay 10 silvers.", "next_node": "debt_confrontation", "condition": "world_flags.finn_debt_collection_active==true && world_flags.debt_paid_by_elara==false && world_flags.elara_help_agreed==false && inventory.elara_medicine_parcel==0" },
          { "text": "I delivered the medicine.", "next_node": "delivery_reward", "condition": "world_flags.elara_delivery_done==true && world_flags.debt_paid_by_elara==false" },
          { "text": "I know about your 'nighttime business', Elara.", "next_node": "drug_confrontation", "condition": "world_flags.elara_secret_known==true && world_flags.debt_paid_by_elara==false" },
          { "text": "Goodbye, Elara.", "closes_dialogue": true }
        ]
      },
      "debt_confrontation": {
        "npc_text": "Ten silvers? I'm just a simple herbalist. Perhaps we can work something out?",
        "player_choices": [
          { "text": "Is there any other way you could pay?", "next_node": "elara_help_offer" },
          { "text": "No, you pay now.", "next_node": "elara_angry_refusal" }
        ]
      },
      "elara_help_offer": {
        "npc_text": "Well... I have a package that needs to go to the sewers. It's just... medicine. For the poor. But the guards are strict. Deliver it, and I'll pay you.",
        "player_choices": [
          { "text": "I'll do it.", "action": "add_item:elara_medicine_parcel:1|set_flag:elara_help_agreed:true", "closes_dialogue": true, "condition": "inventory.elara_medicine_parcel==0" },
          { "text": "No.", "closes_dialogue": true }
        ]
      },
      "elara_angry_refusal": {
        "npc_text": "Get out of my hovel you piece of garbage!",
        "player_choices": [
          { "text": "Leave.", "closes_dialogue": true }
        ]
      },
      "delivery_reward": {
        "npc_text": "You did? Good. Here is the 10 silvers for Finn. And thank you... for being discreet.",
        "player_choices": [
          { "text": "Take the money.", "action": "collect_debt_from:npc_elara", "closes_dialogue": true }
        ]
      },
      "drug_confrontation": {
        "npc_text": "Shh! Keep your voice down! Who told you?!",
        "player_choices": [
          { "text": "Doesn't matter. Pay the 10 silvers, or the guards find out.", "next_node": "drug_blackmail" }
        ]
      },
      "drug_blackmail": {
        "npc_text": "Fine! Fine! Here! Just take it and keep your mouth shut!",
        "player_choices": [
          { "text": "Pleasure doing business.", "action": "collect_debt_from:npc_elara|add_xp:coercion:50|update_relationship:npc_elara:-40|set_flag:elara_blackmailed:true", "closes_dialogue": true }
        ]
      }
    }
  },
  "barkip_default": {
    "nodes": {
      "0": {
        "npc_text": "What'll it be? Ale's 1 silver.",
        "player_choices": [
          { "text": "Ale, please.", "action": "remove_money:1|add_item:ale:1", "closes_dialogue": true, "condition": "money>=1" },
          { "text": "Hear any rumors?", "next_node": "rumors" },
          { "text": "Nothing.", "closes_dialogue": true }
        ]
      },
      "rumors": {
        "npc_text": "They say the Tidehunters are recruiting. And Old Man Finn is in a foul mood lately. Watch yourself.",
        "player_choices": [ { "text": "Thanks.", "closes_dialogue": true } ]
      }
    }
  },
  "stan_default": {
    "nodes": {
      "0": {
        "npc_text": "Halt! What business do you have at Mosswatch Keep?",
        "player_choices": [
          { "text": "I have something to report.", "next_node": "matthias_report" },
          { "text": "Just passing through.", "closes_dialogue": true }
        ]
      },
      "1": {
        "npc_text": "Try Sergeant Rodrick in the Tidehunter Quarter.",
        "player_choices": [ { "text": "Back", "next_node": "0" } ]
      },
      "matthias_report": {
        "npc_text": "I don't have time for drunk talk. Make it quick.",
        "player_choices": [
          { "text": "[Show Blade] I found this prototype.", "next_node": "matthias_evidence", "condition": "inventory.prototype_blade>=1" },
          { "text": "Never mind.", "closes_dialogue": true }
        ]
      },
      "matthias_evidence": {
        "npc_text": "Let me see that. ... This alloy... this is contraband. Shadow steel. Finn has been smuggling this under our noses?",
        "player_choices": [
          { "text": "There's more where that came from.", "next_node": "matthias_plan" }
        ]
      },
      "matthias_plan": {
        "npc_text": "This is enough for a warrant. Go to Sergeant Rodrick in the Tidehunter Quarter. He will organize the raid.",
        "player_choices": [
          { "text": "I'll go now.", "closes_dialogue": true, "action": "advance_quest_stage:rebel_path|remove_item:prototype_blade:1" }
        ]
      },
      "matthias_raid_ready": {
        "npc_text": "My men are on standby. Go to the Salty Mug. The option to Raid will be available.",
        "player_choices": [
          { "text": "Understood.", "closes_dialogue": true }
        ]
      }
    }
  },
  "shaky_jace_default": {
    "nodes": {
      "0": {
        "npc_text": "Spare a coin? Just one coin... I need my fix...",
        "player_choices": [
          { "text": "Here's 3 coppers.", "action": "remove_money:3:copper", "next_node": "jace_talk", "condition": "currency.copper>=3" },
          { "text": "Get lost.", "closes_dialogue": true }
        ]
      },
      "jace_talk": {
        "npc_text": "Bless you! Bless you! The lady at the Hovel... she has the good stuff. The BEST stuff. But only at night... shhh.",
        "player_choices": [
          { "text": "The Herbalist? Elara?", "next_node": "jace_secret" }
        ]
      },
      "jace_secret": {
        "npc_text": "Yes, yes! She sells to us... keeps us warm... don't tell the guards! She'll stop selling!",
        "player_choices": [
          { "text": "Interesting. (Leave)", "closes_dialogue": true, "action": "set_flag:elara_secret_known:true" }
        ]
      }
    }
  }
}

